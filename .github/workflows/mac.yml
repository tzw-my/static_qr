name: x pkg test bin
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  workflow_dispatch:

jobs:
  linux_x64:
    runs-on: ubuntu-latest
    env:
      github_token: ${{ secrets.GITHUB_TOKEN }}
      ssh_key: ${{ secrets.REPO_SSH_KEY }}
      git_user: tzw-my
      git_email: tzw@x-cmd.com
    steps:
      - name: main
        uses: x-cmd/action@main
        with:
          code: |
            x pkg ll

  # x pkg ll | for pkg_bin in $(cat); do
  #   [ "${pkg_bin}" = "${pkg_bin%%sdkman*}" ] || continue
  #   [ "${pkg_bin}" = "${pkg_bin%%lang*}" ] || continue
  #   [ "${pkg_bin}" = "${pkg_bin%%plugin*}" ] || continue
  #   url="$( ___x_cmd_pkg___list "${app}" "v0.0.0" "linux/x64" "url.internet" )"
  #   app_name="${url##*/}"
  #   mkdir -p "./${app}"
  #   curl -L "$url" -o "./${app}/${app_name}"
  #   bin_name="$( ___x_cmd_pkg___list "${app}" "v0.0.0" "linux/x64" "xbin" )"
  #   bin_path="$(find ./ -name "${bin_name}")"
  #   $bin_path --help
  # done
  # mac_x64:
  #   runs-on: mac-latest
  #   env:
  #     github_token: ${{ secrets.GITHUB_TOKEN }}
  #     ssh_key: ${{ secrets.REPO_SSH_KEY }}
  #     git_user: tzw-my
  #     git_email: tzw@x-cmd.com
  #   steps:
  #     - name: main
  #       uses: x-cmd/action@main
  #       with:
  #         code: |
  #           x pkg ll | for pkg_bin in $(cat); do
  #             [ "${pkg_bin}" = "${pkg_bin%%sdkman*}" ] || continue
  #             [ "${pkg_bin}" = "${pkg_bin%%lang*}" ] || continue
  #             [ "${pkg_bin}" = "${pkg_bin%%plugin*}" ] || continue
  #             url="$( ___x_cmd_pkg___list "${app}" "v0.0.0" "darwin/x64" "url.cn" )"
  #             app_name="${url##*/}"
  #             mkdir -p "./${app}"
  #             curl -L "$url" -o "./${app}/${app_name}"
  #             bin_name="$( ___x_cmd_pkg___list "${app}" "v0.0.0" "darwin/x64" "xbin" )"
  #             bin_path="$(find ./ -name "${bin_name}")"
  #             $bin_path --help
  #           done
  # windows_x64:
  #   runs-on: windows-latest
  #   env:
  #     github_token: ${{ secrets.GITHUB_TOKEN }}
  #     ssh_key: ${{ secrets.REPO_SSH_KEY }}
  #     git_user: tzw-my
  #     git_email: tzw@x-cmd.com
  #   steps:
  #     - name: main
  #       uses: x-cmd/action@main
  #       with:
  #         code: |
  #           x pkg ll | for pkg_bin in $(cat); do
  #             [ "${pkg_bin}" = "${pkg_bin%%sdkman*}" ] || continue
  #             [ "${pkg_bin}" = "${pkg_bin%%lang*}" ] || continue
  #             [ "${pkg_bin}" = "${pkg_bin%%plugin*}" ] || continue
  #             url="$( ___x_cmd_pkg___list "${app}" "v0.0.0" "win/x64" "url.cn" )"
  #             app_name="${url##*/}"
  #             mkdir -p "./${app}"
  #             curl -L "$url" -o "./${app}/${app_name}"
  #             bin_name="$( ___x_cmd_pkg___list "${app}" "v0.0.0" "win/x64" "xbin" )"
  #             bin_path="$(find ./ -name "${bin_name}")"
  #             $bin_path --help
  #           done