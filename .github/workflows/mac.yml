name: build tig
on:
  push:
    branches: [ main ]
    
  workflow_dispatch:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: build tig
        run: |
          dir="$(pwd)"
          sudo apt update
          sudo apt install -y gcc g++ wget make automake autoconf pkg-config m4 curl libtool libncursesw5-dev libreadline-dev libiconv-hook-dev
          curl -LO https://github.com/jonas/tig/releases/download/tig-2.5.8/tig-2.5.8.tar.gz
          tar xvf tig-2.5.8.tar.gz 
          cd tig-2.5.8 && {
              export LD_LIBRARY_PATH=/lib:/usr/lib://usr/local/lib:/usr/lib/aarch64-linux-gnu
              export LIBRARY_PATH=/lib:/usr/lib://usr/local/lib:/usr/lib/aarch64-linux-gnu
              export CPATH=/usr/include:/usr/local/include
              ./configure --with-ncurses --prefix=${dir}/tig_linux_x64
              make LDFLAGS="-static"
              make install
          }
          (
            strip ${dir}/tig_linux_x64/bin/tig
            ldd ${dir}/tig_linux_x64/bin/tig || true
            printf "%s" "---------"
            cd "${dir}" && {
              tar cJvf tig_linux_x64.tar.xz tig_linux_x64
            }
          )
      - uses: actions/upload-artifact@v3
        with:
          path: tig_linux_x64.tar.xz
          name: tig
