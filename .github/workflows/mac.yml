name: x pkg build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      github_token: ${{ secrets.MINIMUM_PRIVILEGE_TOKEN }}
      ssh_key: ${{ secrets.REPO_SSH_KEY }}
      git_user: tzw-my
      git_email: tzw@x-cmd.com
      repo_name: bit
    steps:
      - name: main
        uses: x-cmd/action@main
        with:
          code: |
            x log init pkg_test
            while read -r name; do
              pkg_test:info "$name"
              if ! x "$name" --help >/dev/null 2>&1; then
                pkg_test:error "$name"
              fi
            done <<A
              $(printf "%s\n" 7za aliyun bat bit brook bun bwrap chatgpt curl difft duf dust exa fd ffuf fzf gh gitea gitleaks gitui goreleaser gost gotop grex gum helix helm hyperfine jq k3d kind kube-capacity kube-linter kube-score kubectx lazygit micro minikube mirrord mosquitto pandoc procs proot qrencode rclone rg sodium sqlean termshark terraform tig tmux tokei trdsql ucloud usql ws4sqlite xsv yq zellij zenith)
            A


